<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Robot Collector Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: Arial;
      background-color: #111;
    }
    canvas {
      display: block;
      background: #222;
    }
    #hud {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <div id="hud">
    Score: <span id="score">0</span><br />
    Budget: <span id="budget">100</span>
  </div>
  <canvas id="gameCanvas" width="800" height="400"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    ctx.canvas.width  = window.innerWidth;
    ctx.canvas.height = window.innerHeight / 2;

    // Images
    const cloudImage = new Image();
    cloudImage.src = "cloud.png";

    const robotImage = new Image();
    robotImage.src = "https://opengameart.org/sites/default/files/robot-preview.png";

    const groundHeight = 60;

    const robot = {
      x: 100,
      y: 0,
      width: 60,
      height: 60,
      vy: 0,
      jumpPower: -10,
      gravity: 0.5,
      onGround: true,
      ducking: false,
      normalHeight: 40,
      duckHeight: 20,
    };

    let items = [];
    let clouds = [];
    let speed = 3;
    let score = 0;
    let budget = 100;
    let gameOver = false;
    let frameCount = 0;

    const itemValues = [100, 200, 300, 400, 500];

    function getGroundLevel(h) {
      return canvas.height - groundHeight - h;
    }

    robot.y = getGroundLevel(robot.height);

    for (let i = 0; i < 5; i++) {
      clouds.push({
        x: Math.random() * canvas.width,
        y: Math.random() * 100,
        width: 120 + Math.random() * 60,
        height: 80,
        speed: 0.2 + Math.random() * 0.2
      });
    }

    function spawnItem() {
      const value = itemValues[Math.floor(Math.random() * itemValues.length)];
      const chance = Math.random();
      const is500 = speed > 5 && chance < 0.3;
      const finalValue = is500 ? 500 : value;

      const heights = [
        getGroundLevel(30),
        getGroundLevel(80),
        getGroundLevel(130),
      ];
      const randomY = heights[Math.floor(Math.random() * heights.length)];

      items.push({
        x: canvas.width + 20,
        y: randomY,
        width: 30,
        height: 30,
        value: finalValue,
      });
    }

    function update() {
      if (gameOver) return;

      robot.vy += robot.gravity;
      robot.y += robot.vy;

      const targetHeight = robot.ducking ? robot.duckHeight : robot.normalHeight;
      const groundLevel = getGroundLevel(targetHeight);

      if (robot.y >= groundLevel) {
        robot.y = groundLevel;
        robot.vy = 0;
        robot.onGround = true;
      } else {
        robot.onGround = false;
      }

      robot.height = targetHeight;

      for (let i = items.length - 1; i >= 0; i--) {
        const item = items[i];
        item.x -= speed;

        if (
          robot.x < item.x + item.width &&
          robot.x + robot.width > item.x &&
          robot.y < item.y + item.height &&
          robot.y + robot.height > item.y
        ) {
          budget -= 1;

          if (item.value === 200) {
            score += 1;
            speed += 0.5;
          } else if (item.value === 500) {
            speed = Math.max(0, speed - 0.5);
          }

          items.splice(i, 1);
        } else if (item.x + item.width < 0) {
          items.splice(i, 1);
        }
      }

      for (let cloud of clouds) {
        cloud.x -= cloud.speed;
        if (cloud.x + cloud.width < 0) {
          cloud.x = canvas.width + Math.random() * 100;
          cloud.y = Math.random() * 100;
        }
      }

      if (budget <= 0 || speed <= 0) {
        gameOver = true;
        alert("Game Over!");
      }

      document.getElementById("score").innerText = score;
      document.getElementById("budget").innerText = budget;

      frameCount++;
      if (frameCount % 60 === 0) spawnItem();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const skyGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      skyGradient.addColorStop(0, '#333');
      skyGradient.addColorStop(1, '#222');
      ctx.fillStyle = skyGradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      for (let cloud of clouds) {
        ctx.drawImage(cloudImage, cloud.x, cloud.y, cloud.width, cloud.height);
      }

      const groundY = canvas.height - groundHeight;
      const groundGradient = ctx.createLinearGradient(0, groundY, 0, canvas.height);
      groundGradient.addColorStop(0, '#4a2d1c');
      groundGradient.addColorStop(1, '#2e1a10');
      ctx.fillStyle = groundGradient;
      ctx.fillRect(0, groundY, canvas.width, groundHeight);

      // Robot Image
      ctx.drawImage(robotImage, robot.x, robot.y, robot.width, robot.height);

      // Items
      items.forEach(item => {
        ctx.fillStyle = "#0af";
        ctx.fillRect(item.x, item.y, item.width, item.height);
        ctx.fillStyle = "#fff";
        ctx.fillText(item.value, item.x + 5, item.y + 20);
      });
    }

    function loop() {
      update();
      draw();
      if (!gameOver) requestAnimationFrame(loop);
    }

    document.addEventListener("keydown", (e) => {
      if (e.code === "Space" && robot.onGround && !robot.ducking) {
        robot.vy = robot.jumpPower;
      }
      if (e.code === "ArrowDown") {
        robot.ducking = true;
      }
    });

    document.addEventListener("keyup", (e) => {
      if (e.code === "ArrowDown") {
        robot.ducking = false;
      }
    });

    robotImage.onload = () => {
      loop();
    };
  </script>
</body>
</html>
